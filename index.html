<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic HTML Loader and Image Serving</title>
  <script>
    // Function to parse the custom query string with ? instead of &
    function getUrlParams() {
      const params = {};
      const queryString = window.location.search.slice(1); // Remove the leading "?"
      const pairs = queryString.split('?'); // Split by custom ? separator
      pairs.forEach(pair => {
        const [key, value] = pair.split('=');
        if (key && value) {
          params[key] = decodeURIComponent(value);
        }
      });
      return params;
    }

    // Function to load the HTML based on the query parameters
    function loadHTML(params) {
      const htmlFile = params.html;
      if (htmlFile) {
        const htmlPath = `./${htmlFile}.html`;
        console.log(`Loading HTML content from: ${htmlPath}`);
        fetch(htmlPath)
          .then(response => {
            if (response.ok) {
              return response.text();
            } else {
              throw new Error("Failed to load HTML file.");
            }
          })
          .then(htmlContent => {
            // Create an iframe and insert the HTML content
            const iframe = document.createElement("iframe");
            iframe.srcdoc = htmlContent;
            iframe.style.width = "100%";
            iframe.style.height = "100vh";
            iframe.style.border = "none";
            iframe.style.position = "absolute";
            iframe.style.top = "0";
            iframe.style.left = "0";
            document.body.appendChild(iframe);
          })
          .catch(error => {
            console.error(error);
            document.body.innerHTML = "Error loading HTML content.";
          });
      }
    }

    // Function to serve an image based on the query parameters
    function serveImage(params) {
      const color = params.color || 'default';
      const button = params.button || 'default';
      const imageName = `${color}-${button}.png`;
      
      const img = new Image();
      img.src = `./${imageName}`; // Check if the image exists in the same directory

      img.onload = () => {
        document.body.appendChild(img); // If the image exists, show it
      };

      img.onerror = () => {
        const fallbackImg = new Image();
        fallbackImg.src = './404.png'; // Fallback image if the desired image isn't found
        document.body.appendChild(fallbackImg);
      };
    }

    // Execute the necessary function based on URL parameters
    document.addEventListener("DOMContentLoaded", () => {
      const params = getUrlParams();

      // Check if it's an image request (check if `color` and `button` are present)
      if (params.color || params.button) {
        serveImage(params);
      } else {
        loadHTML(params);
      }
    });
  </script>
</head>
<body style="margin: 0; overflow: hidden;">
  <h1>Dynamic Content Loader and Image Server</h1>
</body>
</html>
